<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>1</storyId>
    <title>Basic Chat UI Layout</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-03 18:02</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-1-basic-chat-ui-layout.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>student</asA>
    <iWant>a chat interface where I can see my conversation with the AI tutor</iWant>
    <soThat>I can follow our dialogue as we work through problems</soThat>
    <tasks>
      <task id="1" title="Create MessageList component">
        <subtasks>
          <subtask>Create `components/chat/MessageList.tsx` file</subtask>
          <subtask>Implement message container that displays messages in chronological order</subtask>
          <subtask>Display student messages on right side with distinct styling</subtask>
          <subtask>Display AI tutor messages on left side with distinct styling</subtask>
          <subtask>Add timestamp or sequence indicator to each message</subtask>
          <subtask>Style messages with Tailwind CSS following architecture patterns</subtask>
          <subtask>Ensure component is accessible (ARIA labels, keyboard navigation)</subtask>
        </subtasks>
      </task>
      <task id="2" title="Create Message component">
        <subtasks>
          <subtask>Create `components/chat/Message.tsx` file (or inline in MessageList)</subtask>
          <subtask>Implement message component with role-based styling (student/tutor)</subtask>
          <subtask>Display message content with clean typography</subtask>
          <subtask>Display timestamp or sequence indicator</subtask>
          <subtask>Style student messages on right, AI tutor messages on left</subtask>
          <subtask>Ensure readable typography and spacing</subtask>
        </subtasks>
      </task>
      <task id="3" title="Implement auto-scrolling">
        <subtasks>
          <subtask>Add scroll container with ref for chat area</subtask>
          <subtask>Implement auto-scroll to latest message when new message added</subtask>
          <subtask>Use React useEffect to scroll on message updates</subtask>
          <subtask>Use scrollIntoView or scrollTop for smooth scrolling</subtask>
          <subtask>Handle edge cases (very long messages, many messages)</subtask>
        </subtasks>
      </task>
      <task id="4" title="Create ChatInterface component">
        <subtasks>
          <subtask>Create `components/chat/ChatInterface.tsx` file</subtask>
          <subtask>Integrate MessageList component</subtask>
          <subtask>Create chat container with proper layout</subtask>
          <subtask>Ensure clean, readable typography and spacing</subtask>
          <subtask>Style with Tailwind CSS following architecture patterns</subtask>
          <subtask>Ensure component is accessible (ARIA labels, keyboard navigation)</subtask>
        </subtasks>
      </task>
      <task id="5" title="Integrate ChatInterface into main interface">
        <subtasks>
          <subtask>Update `app/page.tsx` to display ChatInterface component</subtask>
          <subtask>Ensure ChatInterface is visible and accessible on main interface</subtask>
          <subtask>Layout ChatInterface appropriately with problem input components</subtask>
          <subtask>Verify component renders correctly</subtask>
          <subtask>Ensure clean, readable typography and spacing</subtask>
        </subtasks>
      </task>
      <task id="6" title="Add message data structure">
        <subtasks>
          <subtask>Define message type/interface (role, content, timestamp)</subtask>
          <subtask>Create initial message state management</subtask>
          <subtask>Implement message array structure for chronological display</subtask>
          <subtask>Add timestamp generation for messages</subtask>
          <subtask>Export message types for reuse</subtask>
        </subtasks>
      </task>
      <task id="7" title="Testing and verification">
        <subtasks>
          <subtask>Test message container displays messages in chronological order</subtask>
          <subtask>Test student messages appear on right side with distinct styling</subtask>
          <subtask>Test AI tutor messages appear on left side with distinct styling</subtask>
          <subtask>Test messages include timestamp or sequence indicator</subtask>
          <subtask>Test chat area scrolls automatically to latest message</subtask>
          <subtask>Test clean, readable typography and spacing</subtask>
          <subtask>Test with multiple messages (student and tutor)</subtask>
          <subtask>Test with long messages</subtask>
          <subtask>Verify accessibility (keyboard navigation, screen reader)</subtask>
          <subtask>Test responsive design (mobile, tablet, desktop)</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Chat message container displays messages in chronological order</criterion>
    <criterion id="2">Student messages appear on right side with distinct styling</criterion>
    <criterion id="3">AI tutor messages appear on left side with distinct styling</criterion>
    <criterion id="4">Messages include timestamp or sequence indicator</criterion>
    <criterion id="5">Chat area scrolls automatically to latest message</criterion>
    <criterion id="6">Clean, readable typography and spacing</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/epics.md" title="Epic Breakdown">
        <section>Epic 2: Chat Interface &amp; LLM Integration - Story 2.1</section>
        <snippet>Story 2.1: Basic Chat UI Layout defines the foundational chat interface for displaying messages. As a student, I want a chat interface where I can see my conversation with the AI tutor, so that I can follow our dialogue as we work through problems. Includes 6 acceptance criteria covering chronological message display, role-based styling (student on right, tutor on left), timestamps, auto-scrolling, and clean typography.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>Project Structure</section>
        <snippet>Chat components in `components/chat/` directory: ChatInterface.tsx (main chat interface), MessageList.tsx (message list component), Message.tsx (individual message component), MessageInput.tsx (future: message input component), TypingIndicator.tsx (future: typing indicator component). Components follow Next.js App Router patterns with TypeScript and Tailwind CSS v4.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>UI/UX Patterns</section>
        <snippet>Use Tailwind CSS utility classes for styling. Follow existing styling patterns from problem input components. Ensure accessibility (ARIA labels, keyboard navigation). Student messages on right side with distinct styling. AI tutor messages on left side with distinct styling. Clean, readable typography and spacing. Auto-scroll to latest message.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>State Management</section>
        <snippet>Use React useState for message state management. Manage message array for chronological display. Each message includes: role (student | tutor), content (string), timestamp (Date | string). Use React useEffect for auto-scrolling on message updates.</snippet>
      </doc>
      <doc path="docs/PRD.md" title="Product Requirements Document">
        <section>Goalpost 2: Basic Chat + LLM Integration</section>
        <snippet>Chat interface for multi-turn dialogue between student and AI tutor. LLM integration for conversation and Socratic questioning. Conversation history maintenance throughout sessions. This story establishes the foundational chat UI layout for displaying messages.</snippet>
      </doc>
      <doc path="docs/stories/1-4-problem-input-validation.md" title="Story 1.4: Problem Input Validation">
        <section>Dev Agent Record - Completion Notes List</section>
        <snippet>Story 1.4 Implementation Complete - 2025-11-03. Validation utilities created at `lib/utils/validation.ts` with `validateProblemText()` function. Component structure established: `components/problem-input/` directory exists with TextInput and ImageUpload components. Chat components will be created in `components/chat/` directory following similar patterns. State management patterns: Components use React useState for state management. Styling patterns: Components use Tailwind CSS v4 utility classes. Accessibility features: Components include comprehensive accessibility features (ARIA labels, keyboard navigation, screen reader support). Main interface integration: Main interface (`app/page.tsx`) coordinates between components.</snippet>
      </doc>
      <doc path="docs/stories/1-3-ocr-vision-llm-integration.md" title="Story 1.3: OCR/Vision LLM Integration">
        <section>Dev Agent Record - Completion Notes List</section>
        <snippet>Story 1.3 Implementation Complete - 2025-11-03. OCR functionality is fully implemented and working. TextInput component enhanced with external value prop for OCR extracted text. ImageUpload component enhanced with OCR integration. Main interface (`app/page.tsx`) coordinates OCR flow between ImageUpload and TextInput components. Use this as reference for component integration patterns.</snippet>
      </doc>
      <doc path="docs/stories/1-2-image-upload-interface.md" title="Story 1.2: Image Upload Interface">
        <section>Dev Agent Record - Completion Notes List</section>
        <snippet>Story 1.2 Implementation Complete - 2025-11-03. ImageUpload component includes comprehensive file validation, error handling with user-friendly messages, and retry functionality. Use this component as reference for error display patterns, styling patterns, and accessibility features.</snippet>
      </doc>
      <doc path="docs/stories/1-1-text-input-interface.md" title="Story 1.1: Text Input Interface">
        <section>Dev Agent Record - Completion Notes List</section>
        <snippet>Story 1.1 Implementation Complete - 2025-11-03. TextInput component created with validation, error display, and accessibility features. Use this component as reference for component patterns, styling patterns, and accessibility features.</snippet>
      </doc>
    </docs>
    <code>
      <file path="socratica/components/problem-input/TextInput.tsx" kind="component" symbol="TextInput" reason="Text input component from Epic 1. Component demonstrates React component patterns with TypeScript, Tailwind CSS styling, accessibility features (ARIA labels, keyboard navigation), state management with useState, and error display patterns. Use this component as reference for component structure, styling patterns, and accessibility patterns when creating chat components.">
        <note>TextInput component provides excellent reference for component patterns, styling patterns, and accessibility features. Follow similar patterns when creating Message and MessageList components.</note>
      </file>
      <file path="socratica/components/problem-input/ImageUpload.tsx" kind="component" symbol="ImageUpload" reason="Image upload component from Epic 1. Component demonstrates React component patterns with TypeScript, Tailwind CSS styling, accessibility features (ARIA labels, keyboard navigation), state management with useState, error display patterns, and useEffect for side effects. Use this component as reference for component structure, styling patterns, accessibility patterns, and useEffect patterns when creating chat components.">
        <note>ImageUpload component provides excellent reference for component patterns, styling patterns, accessibility features, and useEffect patterns. Follow similar patterns when creating ChatInterface component with auto-scrolling.</note>
      </file>
      <file path="socratica/app/page.tsx" kind="component" symbol="Home" reason="Main interface page that coordinates TextInput and ImageUpload components. Component demonstrates React component patterns with state management, event handlers, and component integration. Component will be updated to integrate ChatInterface component alongside or replacing problem input components. Use this component as reference for main interface integration patterns.">
        <note>Main interface page provides reference for component integration patterns. ChatInterface will be integrated into this page alongside or replacing problem input components.</note>
      </file>
      <file path="socratica/components" kind="directory" symbol="components/" reason="React components directory. Contains problem-input/ directory with TextInput and ImageUpload components. Chat components directory `components/chat/` needs to be created. Chat components (ChatInterface.tsx, MessageList.tsx, Message.tsx) need to be created following similar patterns to problem-input components.">
        <note>Components directory exists. Chat components directory and files need to be created following similar patterns to problem-input components.</note>
      </file>
      <file path="socratica/lib/utils/validation.ts" kind="utility" symbol="validation" reason="Validation utilities from Story 1.4. Contains `validateProblemText()` function and helper functions. Use this file as reference for utility function patterns, TypeScript type definitions, and export patterns. Similar utility functions may be needed for message timestamp formatting or message validation in future stories.">
        <note>Validation utilities provide reference for utility function patterns. Similar utility functions may be needed for message formatting or validation in future stories.</note>
      </file>
      <file path="socratica/package.json" kind="manifest" symbol="package.json" reason="Project dependencies. Contains Next.js 16.0.1, React 19.2.0, TypeScript, Tailwind CSS v4. All dependencies available for chat component development. No additional dependencies needed for this story.">
      </file>
      <file path="socratica/tsconfig.json" kind="config" symbol="tsconfig.json" reason="TypeScript configuration with strict mode enabled and import alias `@/*` configured. Use for chat component type definitions and imports.">
      </file>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="16.0.1" reason="Next.js framework with App Router. Chat components use Next.js App Router patterns. Components use 'use client' directive for client-side React components.">
        </package>
        <package name="react" version="19.2.0" reason="React library for UI components. Use React hooks (useState, useEffect, useRef) for state management, side effects (auto-scrolling), and refs (scroll container) in chat components.">
        </package>
        <package name="typescript" version="^5.7.3" reason="TypeScript for type safety. Define message types/interfaces (Message, MessageProps, ChatInterfaceProps) with TypeScript. Use TypeScript for component props and state types.">
        </package>
        <package name="tailwindcss" version="^4.0.0" reason="Tailwind CSS v4 for styling. Use Tailwind utility classes for message styling, chat container layout, typography, spacing, and responsive design. Follow existing styling patterns from problem input components.">
        </package>
      </ecosystem>
    </dependencies>
  </artifacts>

  <testing>
    <strategy>
      <unit>
        <test>Test Message component renders correctly with different roles (student/tutor)</test>
        <test>Test Message component displays message content correctly</test>
        <test>Test Message component displays timestamp or sequence indicator</test>
        <test>Test Message component applies correct styling based on role (student on right, tutor on left)</test>
        <test>Test MessageList component displays messages in chronological order</test>
        <test>Test MessageList component handles empty message array</test>
        <test>Test MessageList component handles single message</test>
        <test>Test MessageList component handles multiple messages</test>
        <test>Test ChatInterface component renders correctly</test>
        <test>Test ChatInterface component integrates MessageList component</test>
        <test>Test auto-scrolling functionality with useEffect</test>
        <test>Test auto-scrolling with very long messages</test>
        <test>Test auto-scrolling with many messages</test>
        <test>Test message type/interface validation</test>
        <test>Test timestamp generation for messages</test>
      </unit>
      <integration>
        <test>Test ChatInterface integration into main interface (app/page.tsx)</test>
        <test>Test ChatInterface renders correctly with problem input components</test>
        <test>Test message state management across components</test>
        <test>Test auto-scrolling works when new messages are added</test>
        <test>Test message array structure for chronological display</test>
      </integration>
      <accessibility>
        <test>Test ARIA labels are present and correct</test>
        <test>Test keyboard navigation works correctly</test>
        <test>Test screen reader compatibility (NVDA, JAWS, VoiceOver)</test>
        <test>Test focus management for message list</test>
        <test>Test color contrast meets WCAG AA standards</test>
      </accessibility>
      <ui>
        <test>Test student messages appear on right side with distinct styling</test>
        <test>Test AI tutor messages appear on left side with distinct styling</test>
        <test>Test messages include timestamp or sequence indicator</test>
        <test>Test clean, readable typography and spacing</test>
        <test>Test responsive design on mobile devices (320px, 375px, 414px)</test>
        <test>Test responsive design on tablet devices (768px, 1024px)</test>
        <test>Test responsive design on desktop devices (1280px, 1920px)</test>
        <test>Test chat area scrolls automatically to latest message</test>
        <test>Test with multiple messages (student and tutor)</test>
        <test>Test with long messages (message wrapping, overflow handling)</test>
      </ui>
    </strategy>
    <standards>
      <standard>WCAG 2.1 Level AA compliance for accessibility</standard>
      <standard>TypeScript strict mode compliance</standard>
      <standard>Next.js App Router patterns</standard>
      <standard>React 19.2.0 best practices</standard>
      <standard>Tailwind CSS v4 utility class patterns</standard>
      <standard>Component structure patterns from Epic 1 (problem-input components)</standard>
    </standards>
  </testing>
</story-context>





