<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>0</epicId>
    <storyId>2</storyId>
    <title>Firebase Project Setup</title>
    <status>drafted</status>
    <generatedAt>2025-11-03 16:14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/0-2-firebase-project-setup.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>set up Firebase project with Firestore, Auth, and Storage</iWant>
    <soThat>backend services are ready for integration</soThat>
    <tasks>
      <task id="1" title="Create Firebase project in console">
        <subtasks>
          <subtask>Create new Firebase project in Firebase Console</subtask>
          <subtask>Set project name to match application name</subtask>
          <subtask>Verify project created successfully</subtask>
        </subtasks>
      </task>
      <task id="2" title="Initialize Firestore database">
        <subtasks>
          <subtask>Navigate to Firestore Database in Firebase Console</subtask>
          <subtask>Create database in test mode (for MVP)</subtask>
          <subtask>Select location for database</subtask>
          <subtask>Verify database initialized</subtask>
        </subtasks>
      </task>
      <task id="3" title="Enable Firebase Authentication">
        <subtasks>
          <subtask>Navigate to Authentication in Firebase Console</subtask>
          <subtask>Enable Google Sign-In provider</subtask>
          <subtask>Configure OAuth consent screen if needed</subtask>
          <subtask>Verify Google Sign-In enabled</subtask>
        </subtasks>
      </task>
      <task id="4" title="Create Firebase Storage bucket">
        <subtasks>
          <subtask>Navigate to Storage in Firebase Console</subtask>
          <subtask>Create storage bucket</subtask>
          <subtask>Configure security rules (authenticated users only for MVP)</subtask>
          <subtask>Verify storage bucket created</subtask>
        </subtasks>
      </task>
      <task id="5" title="Add Firebase configuration to environment">
        <subtasks>
          <subtask>Create `.env.local` file in project root</subtask>
          <subtask>Add `NEXT_PUBLIC_FIREBASE_API_KEY`</subtask>
          <subtask>Add `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`</subtask>
          <subtask>Add `NEXT_PUBLIC_FIREBASE_PROJECT_ID`</subtask>
          <subtask>Add `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`</subtask>
          <subtask>Add optional variables if available</subtask>
          <subtask>Verify `.env.local` is in `.gitignore`</subtask>
        </subtasks>
      </task>
      <task id="6" title="Install Firebase SDK">
        <subtasks>
          <subtask>Run `npm install firebase`</subtask>
          <subtask>Verify Firebase package added to `package.json`</subtask>
          <subtask>Verify installation successful</subtask>
        </subtasks>
      </task>
      <task id="7" title="Create Firebase config file">
        <subtasks>
          <subtask>Create `lib/firebase/` directory if it doesn't exist</subtask>
          <subtask>Create `lib/firebase/config.ts` file</subtask>
          <subtask>Import Firebase functions from SDK</subtask>
          <subtask>Initialize Firebase app with config from environment variables</subtask>
          <subtask>Export Firebase app instance</subtask>
          <subtask>Follow architecture patterns from `docs/architecture.md`</subtask>
        </subtasks>
      </task>
      <task id="8" title="Structure and test Firebase initialization">
        <subtasks>
          <subtask>Verify Firebase app initializes correctly</subtask>
          <subtask>Test configuration loading in development mode</subtask>
          <subtask>Verify no initialization errors</subtask>
        </subtasks>
      </task>
      <task id="9" title="Create Firebase Auth instance">
        <subtasks>
          <subtask>Create `lib/firebase/auth.ts` file</subtask>
          <subtask>Import `getAuth` from Firebase Auth</subtask>
          <subtask>Initialize auth instance with Firebase app</subtask>
          <subtask>Export auth instance</subtask>
        </subtasks>
      </task>
      <task id="10" title="Create Firestore instance">
        <subtasks>
          <subtask>Create `lib/firebase/firestore.ts` file</subtask>
          <subtask>Import `getFirestore` from Firebase Firestore</subtask>
          <subtask>Initialize Firestore instance with Firebase app</subtask>
          <subtask>Export Firestore instance</subtask>
        </subtasks>
      </task>
      <task id="11" title="Create Firebase Storage instance">
        <subtasks>
          <subtask>Create `lib/firebase/storage.ts` file</subtask>
          <subtask>Import `getStorage` from Firebase Storage</subtask>
          <subtask>Initialize Storage instance with Firebase app</subtask>
          <subtask>Export Storage instance</subtask>
        </subtasks>
      </task>
      <task id="12" title="Verify environment variables loading">
        <subtasks>
          <subtask>Add console.log to test environment variable loading in dev mode</subtask>
          <subtask>Verify all Firebase config values are loaded correctly</subtask>
          <subtask>Remove or comment out console.log after verification</subtask>
          <subtask>Ensure environment variables are accessible</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Firebase project created in Firebase Console</criterion>
    <criterion id="2">Firestore database initialized (start in test mode for MVP)</criterion>
    <criterion id="3">Firebase Authentication enabled with Google Sign-In provider</criterion>
    <criterion id="4">Firebase Storage bucket created with appropriate security rules</criterion>
    <criterion id="5">Firebase configuration values added to `.env.local`: `NEXT_PUBLIC_FIREBASE_API_KEY`, `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`, `NEXT_PUBLIC_FIREBASE_PROJECT_ID`, `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`, optional variables</criterion>
    <criterion id="6">Firebase SDK installed (`npm install firebase`)</criterion>
    <criterion id="7">Firebase config file created at `lib/firebase/config.ts` following architecture patterns</criterion>
    <criterion id="8">Firebase initialization code properly structured and tested</criterion>
    <criterion id="9">Firebase Auth instance exported from `lib/firebase/auth.ts`</criterion>
    <criterion id="10">Firestore instance exported from `lib/firebase/firestore.ts`</criterion>
    <criterion id="11">Firebase Storage instance exported from `lib/firebase/storage.ts`</criterion>
    <criterion id="12">Environment variables properly loaded (test with `console.log` in dev mode)</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/epics.md" title="Epic Breakdown">
        <section>Project Setup (Foundation Stories) - Story 0.2</section>
        <snippet>Story 0.2: Firebase Project Setup defines the foundation story for setting up Firebase project with Firestore, Auth, and Storage. Includes 12 acceptance criteria covering Firebase Console setup, SDK installation, configuration files, and service instance exports. Prerequisites: Story 0.1 (project initialized).</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>Firebase SDK</section>
        <snippet>Firebase SDK v10+ used for backend services. Services include Firestore (NoSQL database), Auth (Google Sign-In), and Storage (image uploads). Rationale: Integrated backend services, real-time capabilities, easy setup.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>Frontend ↔ Firebase</section>
        <snippet>Firebase integration points: `lib/firebase/auth.ts` → Firebase Auth (Google Sign-In), `lib/firebase/firestore.ts` → Firestore (conversation history), `lib/firebase/storage.ts` → Firebase Storage (image uploads).</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>ADR-002: Firebase for Backend Services</section>
        <snippet>Decision to use Firebase (Firestore, Auth, Storage) for all backend services. Rationale: Rapid MVP development, integrated authentication and storage, real-time capabilities, generous free tier.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>ADR-004: Minimal Authentication (Google Sign-In)</section>
        <snippet>Decision to use Firebase Auth with Google Sign-In only. Rationale: Fast setup, one-click sign-in reduces friction, COPPA compliant, email available for age verification.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>Security Architecture</section>
        <snippet>Firebase Auth uses OAuth 2.0 flow handled by Firebase. User tokens stored securely in Firebase. Session management via Firebase Auth state. Data encryption at rest managed by Firebase.</snippet>
      </doc>
      <doc path="docs/architecture.md" title="Architecture - Socratica">
        <section>Development Environment</section>
        <snippet>Environment variables required: `NEXT_PUBLIC_FIREBASE_API_KEY`, `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`, `NEXT_PUBLIC_FIREBASE_PROJECT_ID`, `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`. Optional: `NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID`, `NEXT_PUBLIC_FIREBASE_APP_ID`.</snippet>
      </doc>
      <doc path="docs/stories/0-1-project-initialization.md" title="Story 0.1: Project Initialization">
        <section>Dev Agent Record - Completion Notes List</section>
        <snippet>Project initialized with Next.js 16.0.1. All required directories created: `components/`, `lib/`, `hooks/`, `types/`. TypeScript strict mode enabled, import alias `@/*` configured. Build process verified working. Environment variables location: `.env.local` file should be created in project root.</snippet>
      </doc>
    </docs>
    <code>
      <file path="socratica/lib" kind="directory" symbol="lib/" reason="Utilities and configurations directory. Firebase files will be created in `lib/firebase/` subdirectory. Directory exists but is currently empty.">
        <note>Directory exists from Story 0.1. Firebase subdirectory needs to be created.</note>
      </file>
      <file path="socratica/package.json" kind="manifest" symbol="package.json" reason="Project dependencies and scripts. Firebase SDK needs to be added via `npm install firebase`. Currently contains Next.js, React, TypeScript, Tailwind CSS, ESLint.">
        <note>Firebase package not yet installed. Will be added in Task 6.</note>
      </file>
      <file path="socratica/tsconfig.json" kind="config" symbol="tsconfig.json" reason="TypeScript configuration with strict mode enabled and import alias `@/*` configured. Use this for Firebase imports.">
      </file>
      <file path="socratica/next.config.ts" kind="config" symbol="next.config.ts" reason="Next.js configuration. Environment variables with `NEXT_PUBLIC_` prefix are automatically loaded for client-side access.">
      </file>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="16.0.1" reason="Next.js framework with App Router. Environment variables automatically loaded from `.env.local`.">
        </package>
        <package name="react" version="19.2.0" reason="React library for UI components.">
        </package>
        <package name="react-dom" version="19.2.0" reason="React DOM renderer.">
        </package>
        <package name="typescript" version="^5" reason="TypeScript language for type safety. Strict mode enabled.">
        </package>
        <package name="firebase" version="latest" reason="Firebase SDK v10+ for Firestore, Auth, and Storage services. Must be installed via `npm install firebase`.">
        </package>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture">
      <name>Firebase Setup Structure</name>
      <description>Firebase configuration files must be in `lib/firebase/` directory. Separate files for config, auth, firestore, and storage instances. Firebase app initialized once and reused across instances.</description>
      <source>docs/architecture.md#Project-Structure</source>
    </constraint>
    <constraint type="architecture">
      <name>Firebase SDK Version</name>
      <description>Must use Firebase SDK v10+ (latest stable version).</description>
      <source>docs/architecture.md#Firebase-SDK</source>
    </constraint>
    <constraint type="configuration">
      <name>Environment Variables</name>
      <description>Firebase configuration values must be added to `.env.local` file in project root (not in `socratica/` subdirectory). Use `NEXT_PUBLIC_` prefix for client-side access. File must be in `.gitignore` to prevent committing secrets.</description>
      <source>docs/epics.md#Story-0.2</source>
    </constraint>
    <constraint type="security">
      <name>Security Rules (MVP)</name>
      <description>Firestore: Test mode initially (will be restricted later). Storage: Authenticated users only (can be refined later). Auth: Google Sign-In only (as per architecture decision ADR-004).</description>
      <source>docs/epics.md#Story-0.2</source>
    </constraint>
    <constraint type="naming">
      <name>Naming Patterns</name>
      <description>Follow naming patterns from Story 0.1: Files match component name exactly (e.g., `auth.ts` exports auth instance), functions use camelCase, constants use UPPER_SNAKE_CASE.</description>
      <source>docs/stories/0-1-project-initialization.md#Dev-Notes</source>
    </constraint>
    <constraint type="directory">
      <name>Project Structure</name>
      <description>Project structure matches architecture document. `lib/` directory exists from Story 0.1. Firebase files should be created in `lib/firebase/` subdirectory as specified in architecture.</description>
      <source>docs/stories/0-1-project-initialization.md#Dev-Agent-Record</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface name="Firebase App" kind="SDK instance" signature="Firebase app initialized from environment variables" path="lib/firebase/config.ts">
      <description>Main Firebase app instance initialized from environment variables. Must be initialized once and exported for reuse across auth, firestore, and storage instances.</description>
    </interface>
    <interface name="Firebase Auth" kind="SDK instance" signature="getAuth(app) - Firebase Auth instance" path="lib/firebase/auth.ts">
      <description>Firebase Auth instance initialized with Firebase app. Configured for Google Sign-In only (ADR-004). Exported for use in authentication components.</description>
    </interface>
    <interface name="Firestore" kind="SDK instance" signature="getFirestore(app) - Firestore instance" path="lib/firebase/firestore.ts">
      <description>Firestore instance initialized with Firebase app. Configured for conversation history and user data storage. Exported for use in API routes and components.</description>
    </interface>
    <interface name="Firebase Storage" kind="SDK instance" signature="getStorage(app) - Firebase Storage instance" path="lib/firebase/storage.ts">
      <description>Firebase Storage instance initialized with Firebase app. Configured for image upload storage. Security rules: authenticated users only for MVP. Exported for use in image upload components.</description>
    </interface>
    <interface name="Environment Variables" kind="configuration" signature="NEXT_PUBLIC_FIREBASE_* variables in .env.local" path=".env.local">
      <description>Firebase configuration values loaded from `.env.local` file. Required variables: API_KEY, AUTH_DOMAIN, PROJECT_ID, STORAGE_BUCKET. Optional: MESSAGING_SENDER_ID, APP_ID. Must use `NEXT_PUBLIC_` prefix for client-side access in Next.js.</description>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing standards for this story focus on verifying Firebase setup and configuration rather than application functionality. Key verification points include: Firebase project created in console, Firestore database initialized in test mode, Google Sign-In authentication enabled, Storage bucket created with security rules, environment variables properly loaded from `.env.local`, Firebase SDK installed successfully, Firebase app initializes correctly without errors, all service instances (auth, firestore, storage) are properly exported. Manual verification is appropriate for this foundational setup story, with automated tests to be added in subsequent stories once Firebase services are integrated into application components.
    </standards>
    <locations>
      <location>Manual verification (no test files yet for Firebase setup story)</location>
      <location>Future tests will be co-located with components: `components/**/*.test.tsx`</location>
      <location>API route tests: `app/api/**/*.test.ts`</location>
      <location>Firebase integration tests: `lib/firebase/**/*.test.ts` (to be added in future stories)</location>
    </locations>
    <ideas>
      <test id="ac1" criterion="AC: 1" description="Verify Firebase project created: Check Firebase Console for project existence, verify project name matches application name.">
      </test>
      <test id="ac2" criterion="AC: 2" description="Verify Firestore initialized: Check Firebase Console Firestore Database section, verify database created in test mode, verify location selected.">
      </test>
      <test id="ac3" criterion="AC: 3" description="Verify Google Sign-In enabled: Check Firebase Console Authentication section, verify Google Sign-In provider enabled, verify OAuth consent screen configured if needed.">
      </test>
      <test id="ac4" criterion="AC: 4" description="Verify Storage bucket created: Check Firebase Console Storage section, verify bucket created, verify security rules configured (authenticated users only for MVP).">
      </test>
      <test id="ac5" criterion="AC: 5" description="Verify environment variables added: Check `.env.local` file exists in project root, verify all required variables present, verify `.env.local` is in `.gitignore`.">
      </test>
      <test id="ac6" criterion="AC: 6" description="Verify Firebase SDK installed: Run `npm list firebase`, verify Firebase package in `package.json` dependencies, verify node_modules contains firebase package.">
      </test>
      <test id="ac7" criterion="AC: 7" description="Verify config file created: Check `lib/firebase/config.ts` exists, verify Firebase app initialization code, verify exports Firebase app instance, verify follows architecture patterns.">
      </test>
      <test id="ac8" criterion="AC: 8" description="Verify initialization works: Import Firebase app in test file, verify no initialization errors, verify app instance created successfully.">
      </test>
      <test id="ac9" criterion="AC: 9" description="Verify Auth instance exported: Check `lib/firebase/auth.ts` exists, verify imports getAuth from Firebase Auth, verify initializes with Firebase app, verify exports auth instance.">
      </test>
      <test id="ac10" criterion="AC: 10" description="Verify Firestore instance exported: Check `lib/firebase/firestore.ts` exists, verify imports getFirestore from Firebase Firestore, verify initializes with Firebase app, verify exports Firestore instance.">
      </test>
      <test id="ac11" criterion="AC: 11" description="Verify Storage instance exported: Check `lib/firebase/storage.ts` exists, verify imports getStorage from Firebase Storage, verify initializes with Firebase app, verify exports Storage instance.">
      </test>
      <test id="ac12" criterion="AC: 12" description="Verify environment variables loaded: Add console.log in dev mode to test loading, verify all Firebase config values accessible, verify values match Firebase Console configuration.">
      </test>
    </ideas>
  </tests>
</story-context>




